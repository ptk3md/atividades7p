<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Calend√°rio Acad√™mico 2026</title>
<link rel="icon" href="data:,">
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet"/>
<style>
  /* ‚îÄ‚îÄ‚îÄ VARI√ÅVEIS ‚îÄ‚îÄ‚îÄ */
  :root {
    --bg-color: #0f172a;
    --card-bg: rgba(30, 41, 59, 0.7);
    --card-hover: rgba(255, 255, 255, 0.05);
    --card-border: rgba(255, 255, 255, 0.08);
    --text-main: #f1f5f9;
    --text-muted: #94a3b8;
    --accent: #3b82f6;
    --tag-bg: rgba(255,255,255,0.05);
    --tag-bg-active: var(--accent);
    --input-bg: rgba(0,0,0,0.2);
    
    /* Status Colors */
    --danger: #ef4444;   
    --success: #10b981;  
    --warning: #f59e0b;  
    --info: #3b82f6;     
    
    --radius: 16px;
    --font: 'Plus Jakarta Sans', sans-serif;
    --transition: 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
  }

  [data-theme="light"] {
    --bg-color: #f0f4f8;
    --card-bg: rgba(255, 255, 255, 0.65);
    --card-hover: rgba(255, 255, 255, 0.9);
    --card-border: rgba(0, 0, 0, 0.06);
    --text-main: #1e293b;
    --text-muted: #64748b;
    --tag-bg: rgba(0,0,0,0.05);
    --input-bg: rgba(255,255,255,0.5);
    --accent: #2563eb;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; outline: none; -webkit-tap-highlight-color: transparent; }
  
  body {
    font-family: var(--font);
    background-color: var(--bg-color);
    color: var(--text-main);
    min-height: 100vh;
    padding: 2rem 1rem;
    padding-top: 3rem; /* Espa√ßo para barra de progresso */
    transition: background-color var(--transition), color var(--transition);
  }

  .container { max-width: 720px; margin: 0 auto; position: relative; }

  /* 4. BARRA DE PROGRESSO DO SEMESTRE */
  .progress-container {
    position: fixed; top: 0; left: 0; width: 100%; height: 6px;
    background: var(--tag-bg); z-index: 1000;
  }
  .progress-bar {
    height: 100%; background: linear-gradient(90deg, var(--accent), var(--success));
    width: 0%; transition: width 1s ease-out;
    box-shadow: 0 0 10px var(--accent);
  }
  .progress-label {
    position: fixed; top: 10px; right: 10px; font-size: 0.7rem; 
    font-weight: 700; color: var(--text-muted); z-index: 1001;
    background: var(--card-bg); padding: 4px 8px; border-radius: 8px;
    border: 1px solid var(--card-border); backdrop-filter: blur(4px);
  }

  /* HEADER & CONTROLS */
  header { margin-bottom: 2rem; display: flex; justify-content: space-between; align-items: flex-start; }
  h1 { font-size: 2rem; font-weight: 800; letter-spacing: -0.05em; margin-bottom: 0.5rem; }
  .subtitle { color: var(--text-muted); font-size: 0.9rem; font-weight: 600; text-transform: uppercase; }

  .theme-toggle {
    background: var(--card-bg); border: 1px solid var(--card-border); color: var(--text-main);
    width: 44px; height: 44px; border-radius: 12px; display: flex; align-items: center; justify-content: center;
    cursor: pointer; transition: var(--transition);
  }
  .theme-toggle svg { width: 18px; height: 18px; }

  .controls {
    background: var(--card-bg); border: 1px solid var(--card-border);
    backdrop-filter: blur(12px); border-radius: var(--radius); padding: 1.5rem;
    margin-bottom: 2rem;
  }
  .top-tools { display: flex; gap: 1rem; margin-bottom: 1.5rem; }
  .search-box { flex: 1; position: relative; }
  .search-box input {
    width: 100%; background: var(--input-bg); border: 1px solid var(--card-border);
    color: var(--text-main); padding: 12px 12px 12px 40px; border-radius: 10px;
    font-family: var(--font); font-weight: 500;
  }
  .search-icon { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--text-muted); width: 18px; }

  .filter-tags { display: flex; gap: 0.6rem; flex-wrap: wrap; }
  .tag {
    background: var(--tag-bg); border: 1px solid var(--card-border); color: var(--text-muted);
    padding: 8px 14px; border-radius: 20px; font-size: 0.75rem; font-weight: 700;
    cursor: pointer; transition: all 0.2s;
  }
  .tag.active { background: var(--tag-bg-active); color: white; transform: scale(1.05); }

  /* 2. STICKY HEADERS (M√äS) */
  .month-header {
    position: sticky; top: 0px; z-index: 10;
    background: var(--bg-color); /* Fallback */
    backdrop-filter: blur(10px);
    padding: 10px 0; margin-bottom: 10px;
    font-size: 1.1rem; font-weight: 800; color: var(--accent);
    border-bottom: 1px solid var(--card-border);
    text-transform: capitalize;
  }

  /* LISTA & CARDS */
  .event-list { display: flex; flex-direction: column; gap: 0.8rem; padding-bottom: 1rem; }
  
  .event-card {
    display: grid; grid-template-columns: 70px 1fr auto; align-items: stretch;
    background: var(--card-bg); border-radius: 12px; overflow: hidden;
    border: 1px solid transparent; cursor: default; position: relative;
    transition: transform 0.2s, background 0.3s;
  }
  .event-card:hover { transform: translateY(-3px); background: var(--card-hover); border-color: var(--card-border); z-index: 2; }

  .date-box {
    background: var(--input-bg); display: flex; flex-direction: column;
    align-items: center; justify-content: center; padding: 0 10px;
    font-size: 1.1rem; font-weight: 800; line-height: 1; color: var(--text-muted);
  }
  .date-box span { font-size: 0.7rem; font-weight: 600; text-transform: uppercase; margin-top: 4px; }

  .info-box { padding: 14px 18px; display: flex; flex-direction: column; justify-content: center; }
  
  .card-top-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px; }
  .event-name { font-weight: 700; font-size: 1rem; color: var(--text-main); }
  .event-disc { font-size: 0.75rem; color: var(--text-muted); font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; }

  .type-indicator { width: 5px; height: 100%; }
  
  /* Cores Tipos */
  .type-prova .date-box { color: var(--danger); background: rgba(239, 68, 68, 0.15); }
  .type-prova .type-indicator { background: var(--danger); }
  .type-pratica .date-box { color: var(--success); background: rgba(16, 185, 129, 0.15); }
  .type-pratica .type-indicator { background: var(--success); }
  .type-trabalho .date-box { color: var(--info); background: rgba(59, 130, 246, 0.15); }
  .type-trabalho .type-indicator { background: var(--info); }
  .type-final .date-box { color: var(--warning); background: rgba(245, 158, 11, 0.15); }
  .type-final .type-indicator { background: var(--warning); }

  /* 1. BADGES DE URG√äNCIA */
  .badge {
    font-size: 0.65rem; font-weight: 800; padding: 3px 8px; border-radius: 6px;
    letter-spacing: 0.05em; margin-left: 10px; text-transform: uppercase;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }
  .badge-today { background: var(--danger); color: white; animation: pulse 1.5s infinite; }
  .badge-soon { background: var(--warning); color: #000; }
  .badge-normal { background: var(--card-border); color: var(--text-muted); border: 1px solid rgba(255,255,255,0.1); }

  @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

  /* 3. BOT√ÉO CALEND√ÅRIO */
  .actions { padding: 0 10px; display: flex; align-items: center; justify-content: center; }
  .btn-add-cal {
    background: transparent; border: none; color: var(--text-muted);
    cursor: pointer; padding: 8px; border-radius: 8px; transition: all 0.2s;
  }
  .btn-add-cal:hover { background: var(--tag-bg); color: var(--accent); transform: scale(1.1); }
  .btn-add-cal svg { width: 20px; height: 20px; }

  /* 5. SKELETON LOADING */
  .skeleton {
    background: linear-gradient(90deg, var(--card-border) 25%, var(--card-hover) 50%, var(--card-border) 75%);
    background-size: 200% 100%;
    animation: shimmer 1.5s infinite;
    border-radius: 6px;
  }
  .sk-card { height: 74px; border-radius: 12px; margin-bottom: 10px; }
  @keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }

  /* ARQUIVO */
  .archive-section { margin-top: 2rem; border-top: 1px dashed var(--card-border); padding-top: 2rem; }
  .btn-archive-toggle {
    background: var(--tag-bg); color: var(--text-muted); border: 1px solid var(--card-border);
    padding: 10px 24px; border-radius: 99px; font-size: 0.85rem; font-weight: 700;
    cursor: pointer; width: 100%; transition: 0.2s;
  }
  .btn-archive-toggle:hover { background: var(--card-hover); color: var(--text-main); }
  .event-card.is-past { filter: grayscale(1); opacity: 0.5; }
</style>
</head>
<body>

<div class="progress-container"><div class="progress-bar" id="progressBar"></div></div>
<div class="progress-label" id="progressLabel">0%</div>

<div class="container">
  <header>
    <div class="header-text">
      <h1 id="appTitle">Calend√°rio</h1>
      <div class="subtitle" id="appSubtitle">Carregando...</div>
    </div>
    <button class="theme-toggle" id="themeBtn"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg></button>
  </header>

  <div class="controls">
    <div class="top-tools">
      <div class="search-box">
        <input type="text" id="searchInput" placeholder="Buscar..." autocomplete="off">
        <svg class="search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
      </div>
    </div>
    <div class="filter-tags" id="disciplineFilters"></div>
  </div>

  <main id="eventsContainer" class="event-list"></main>
  
  <div class="archive-section" id="archiveSection" style="display: none;">
    <button class="btn-archive-toggle" id="btnToggleArchive">Ver Hist√≥rico (<span id="archiveCount">0</span>)</button>
    <div id="archiveContainer" class="event-list" style="margin-top: 15px; display: none;"></div>
  </div>
</div>

<script>
  const script = document.createElement('script');
  // Adiciona ?v=hora_atual para for√ßar o navegador a baixar a vers√£o nova
  script.src = 'data.js?v=' + new Date().getTime();
  document.body.appendChild(script);
</script>

<script>
if (typeof EXTERNAL_CONFIG === 'undefined') alert("Erro: data.js n√£o carregado.");
const CONFIG = EXTERNAL_CONFIG;

class App {
  constructor() {
    this.events = [];
    this.today = new Date(); this.today.setHours(0,0,0,0);
    this.state = { activeDisc: 'Todas', searchTerm: '', isArchiveOpen: false };
    
    // Inicia com Skeleton Loading
    this.renderSkeleton();
    setTimeout(() => this.init(), 800); // 800ms delay para simular loading
  }

  init() {
    // 1. Processar Dados
    this.events = CONFIG.data.map(item => {
      const [d, m] = item.d.split('/').map(Number);
      const dateObj = new Date(CONFIG.year, m - 1, d);
      return { ...item, dateObj, sortTime: dateObj.getTime() };
    }).sort((a, b) => a.sortTime - b.sortTime);

    document.getElementById('appTitle').innerText = CONFIG.title;
    document.getElementById('appSubtitle').innerText = CONFIG.subtitle;

    this.setupTheme();
    this.setupFilters();
    this.setupSearch();
    this.setupArchive();
    this.updateProgress(); // Calcula barra de progresso
    this.render();
  }

  // ‚îÄ‚îÄ‚îÄ 4. BARRA DE PROGRESSO ‚îÄ‚îÄ‚îÄ
  updateProgress() {
    const start = new Date(CONFIG.semesterStart);
    const end = new Date(CONFIG.semesterEnd);
    const total = end - start;
    const current = this.today - start;
    
    let pct = Math.floor((current / total) * 100);
    if (pct < 0) pct = 0; if (pct > 100) pct = 100;

    document.getElementById('progressBar').style.width = `${pct}%`;
    document.getElementById('progressLabel').innerText = `${pct}% Conclu√≠do`;
  }

  // ‚îÄ‚îÄ‚îÄ 5. SKELETON LOADING ‚îÄ‚îÄ‚îÄ
  renderSkeleton() {
    const container = document.getElementById('eventsContainer');
    container.innerHTML = Array(5).fill('<div class="skeleton sk-card"></div>').join('');
  }

  setupTheme() {
    const btn = document.getElementById('themeBtn');
    let isDark = localStorage.getItem('theme') !== 'light';
    const apply = () => document.body.setAttribute('data-theme', isDark ? 'dark' : 'light');
    apply();
    btn.addEventListener('click', () => { isDark = !isDark; localStorage.setItem('theme', isDark?'dark':'light'); apply(); });
  }

  setupFilters() {
    const uniqueDiscs = ['Todas', ...new Set(this.events.map(e => e.disc))];
    const container = document.getElementById('disciplineFilters');
    uniqueDiscs.forEach(disc => {
      const btn = document.createElement('button');
      btn.className = `tag ${disc === 'Todas' ? 'active' : ''}`;
      btn.textContent = disc;
      btn.onclick = (e) => {
        this.state.activeDisc = disc;
        document.querySelectorAll('.tag').forEach(t => t.classList.remove('active'));
        e.target.classList.add('active');
        this.render();
      };
      container.appendChild(btn);
    });
  }

  setupSearch() {
    document.getElementById('searchInput').oninput = (e) => {
      this.state.searchTerm = e.target.value.toLowerCase();
      this.render();
    };
  }

  setupArchive() {
    const btn = document.getElementById('btnToggleArchive');
    btn.onclick = () => {
        this.state.isArchiveOpen = !this.state.isArchiveOpen;
        const list = document.getElementById('archiveContainer');
        list.style.display = this.state.isArchiveOpen ? 'flex' : 'none';
        btn.innerText = this.state.isArchiveOpen ? "Ocultar Hist√≥rico" : `Ver Hist√≥rico (${document.getElementById('archiveCount').innerText})`;
    };
  }

  fmtBox(d) { return { day: d.getDate().toString().padStart(2,'0'), month: d.toLocaleString('pt-BR',{month:'short'}).replace('.','') }; }

  // ‚îÄ‚îÄ‚îÄ 3. GERAR ARQUIVO .ICS ‚îÄ‚îÄ‚îÄ
  generateICS(ev) {
    const fmt = (d) => d.toISOString().replace(/-|:|\.\d\d\d/g,"").slice(0,15) + "Z";
    const start = fmt(ev.dateObj);
    // Adiciona 1 hora para o fim
    const endDate = new Date(ev.dateObj); endDate.setHours(endDate.getHours() + 1);
    const end = fmt(endDate);

    const icsMsg = [
        "BEGIN:VCALENDAR", "VERSION:2.0", "BEGIN:VEVENT",
        `DTSTART:${start}`, `DTEND:${end}`,
        `SUMMARY:${ev.title}`, `DESCRIPTION:${ev.disc} - ${ev.type}`,
        "END:VEVENT", "END:VCALENDAR"
    ].join("\n");

    const blob = new Blob([icsMsg], { type: 'text/calendar;charset=utf-8' });
    const link = document.createElement('a');
    link.href = window.URL.createObjectURL(blob);
    link.setAttribute('download', `${ev.title}.ics`);
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  }

  // ‚îÄ‚îÄ‚îÄ 1. L√ìGICA DE URG√äNCIA ‚îÄ‚îÄ‚îÄ
  getUrgency(dateObj) {
    const diffTime = dateObj - this.today;
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 
    if (diffDays === 0) return { text: 'Hoje!', class: 'badge-today' };
    if (diffDays === 1) return { text: 'Amanh√£', class: 'badge-soon' };
    if (diffDays > 1 && diffDays <= 5) return { text: `${diffDays} dias`, class: 'badge-soon' };
    return null;
  }

  createCard(ev, isPast) {
    const { day, month } = this.fmtBox(ev.dateObj);
    const urgency = !isPast ? this.getUrgency(ev.dateObj) : null;
    const el = document.createElement('div');
    el.className = `event-card type-${ev.type} ${isPast ? 'is-past' : ''}`;
    
    // Bot√£o Calendar
    const btnCal = document.createElement('button');
    btnCal.className = 'btn-add-cal';
    btnCal.title = "Adicionar ao Calend√°rio";
    btnCal.innerHTML = `<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>`;
    btnCal.onclick = () => this.generateICS(ev);

    el.innerHTML = `
      <div class="date-box">${day}<span>${month}</span></div>
      <div class="info-box">
        <div class="card-top-row">
           <div class="event-name">${ev.title}</div>
           ${urgency ? `<div class="badge ${urgency.class}">${urgency.text}</div>` : ''}
        </div>
        <div class="event-disc">${ev.disc}</div>
      </div>
      <div class="type-indicator" title="${ev.type}"></div>
    `;
    
    // Inserir bot√£o de calend√°rio na grid (coluna extra)
    // Ajustamos css grid para 4 colunas ou usamos absolute? 
    // Vamos usar a estrutura atual e adicionar o bot√£o no final
    const actions = document.createElement('div');
    actions.className = 'actions';
    actions.appendChild(btnCal);
    el.appendChild(actions);

    return el;
  }

  render() {
    const mainContainer = document.getElementById('eventsContainer');
    const archiveContainer = document.getElementById('archiveContainer');
    
    // Filtros
    const filtered = this.events.filter(ev => {
        const inDisc = this.state.activeDisc === 'Todas' || ev.disc === this.state.activeDisc;
        const inSearch = ev.title.toLowerCase().includes(this.state.searchTerm);
        return inDisc && inSearch;
    });

    const futureEvents = filtered.filter(ev => ev.dateObj >= this.today);
    const pastEvents = filtered.filter(ev => ev.dateObj < this.today);

    document.getElementById('archiveCount').innerText = pastEvents.length;
    document.getElementById('archiveSection').style.display = pastEvents.length > 0 ? 'block' : 'none';

    // Render Principal com Sticky Headers
    mainContainer.innerHTML = '';
    if (futureEvents.length === 0) {
        mainContainer.innerHTML = `<div class="empty-state">üçÉ Nada pendente.</div>`;
    } else {
        // ‚îÄ‚îÄ‚îÄ 2. LOGICA DE STICKY HEADERS ‚îÄ‚îÄ‚îÄ
        let currentMonth = '';
        futureEvents.forEach(ev => {
            const evMonth = ev.dateObj.toLocaleString('pt-BR', { month: 'long' });
            if (evMonth !== currentMonth) {
                currentMonth = evMonth;
                const header = document.createElement('div');
                header.className = 'month-header';
                header.innerText = currentMonth;
                mainContainer.appendChild(header);
            }
            mainContainer.appendChild(this.createCard(ev, false));
        });
    }

    // Render Hist√≥rico (Sem headers para simplificar)
    archiveContainer.innerHTML = '';
    pastEvents.forEach(ev => archiveContainer.appendChild(this.createCard(ev, true)));
  }
}

window.onload = () => new App();
</script>
</body>
</html>
